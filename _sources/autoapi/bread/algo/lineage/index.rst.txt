:py:mod:`bread.algo.lineage`
============================

.. py:module:: bread.algo.lineage


Package Contents
----------------

Classes
~~~~~~~

.. autoapisummary::

   bread.algo.lineage.LineageGuesser
   bread.algo.lineage.LineageGuesserBudLum
   bread.algo.lineage.LineageGuesserExpansionSpeed
   bread.algo.lineage.LineageGuesserMinDistance
   bread.algo.lineage.LineageGuesserMinTheta



Functions
~~~~~~~~~

.. autoapisummary::

   bread.algo.lineage.extend_budding_event
   bread.algo.lineage.align_lineages
   bread.algo.lineage.accuracy



.. py:function:: extend_budding_event(lineage: bread.data.Lineage, time_index_num, time_index_max=None)

   add extra time to a budding event from a lineage, for a total of time_index_num frames


.. py:function:: align_lineages(lineage_truth: bread.data.Lineage, lineage_pred: bread.data.Lineage)


.. py:function:: accuracy(lineage_truth: bread.data.Lineage, lineage_pred: bread.data.Lineage, strict: bool = True) -> float

   Compute the accuracy of a guessed lineage

   :param lineage_truth: ground truth lineage
   :type lineage_truth: Lineage
   :param lineage_pred: guessed lineage (see ``bread.algo.lineage.LineageGuesser``)
   :type lineage_pred: Lineage
   :param strict: penalize abscence of a guess, by default True
   :type strict: bool, optional

   :returns: **score**
   :rtype: float


.. py:class:: LineageGuesser

   Bases: :py:obj:`abc.ABC`

   Construct LineageGuesser

   :param seg:
   :type seg: Segmentation
   :param nn_threshold: Cell masks separated by less than this threshold are considered neighbours. by default 8.0.
   :type nn_threshold: float, optional
   :param flexible_threshold: If no nearest neighbours are found within the given threshold, try to find the closest one, by default False.
   :type flexible_threshold: bool, optional
   :param num_frames_refractory: After a parent cell has budded, exclude it from the parent pool in the next frames.
                                 It is recommended to set it to a low estimate, as high values will cause mistakes to propagate in time.
                                 A value of 0 corresponds to no refractory period.
                                 by default 0.
   :type num_frames_refractory: int, optional

   .. py:attribute:: segmentation
      :annotation: :bread.data.Segmentation

      

   .. py:attribute:: nn_threshold
      :annotation: :float = 8

      

   .. py:attribute:: flexible_nn_threshold
      :annotation: :bool = False

      

   .. py:attribute:: num_frames_refractory
      :annotation: :int = 0

      

   .. py:method:: guess_parent(self, bud_id: int, time_id: int) -> int
      :abstractmethod:

      Guess the parent associated to a bud

      :param bud_id: id of the bud in the segmentation
      :type bud_id: int
      :param time_id: frame index in the movie
      :type time_id: int

      :returns: **parent_id** -- guessed parent id
      :rtype: int


   .. py:method:: guess_lineage(self, progress_callback: Optional[Callable[[int, int], None]] = None)

      Guess the full lineage of a given bud.

      :returns: * **lineage** (*Lineage*) -- guessed lineage
                * **progress_callback** (*Callable[[int, int]] or None*) -- callback for progress



.. py:class:: LineageGuesserBudLum

   Bases: :py:obj:`_MajorityVoteMixin`, :py:obj:`LineageGuesser`, :py:obj:`_BudneckMixin`

   Guess lineage relations by looking at the budneck marker intensity along the contour of the bud.

   :param segmentation:
   :type segmentation: Segmentation
   :param budneck_img:
   :type budneck_img: Microscopy
   :param nn_threshold: Cell masks separated by less than this threshold are considered neighbors, by default 8.0.
   :type nn_threshold: float, optional
   :param flexible_nn_threshold: If no nearest neighbours are found within the given threshold, try to find the closest one, by default False.
   :type flexible_nn_threshold: bool, optional
   :param num_frames_refractory: After a parent cell has budded, exclude it from the parent pool in the next frames.
                                 It is recommended to set it to a low estimate, as high values will cause mistakes to propagate in time.
                                 A value of 0 corresponds to no refractory period.
                                 by default 0.
   :type num_frames_refractory: int, optional
   :param num_frames: Number of frames to watch the budneck marker channel for.
                      The algorithm makes a guess for each frame, then predicts a parent by majority-vote policy.
   :type num_frames: int, default 5
   :param offset_frames: Wait this number of frames after bud appears before guessing parent.
                         Useful if the GFP peak is often delayed.
   :type offset_frames: int, default 0
   :param kernel_N: Size of the gaussian smoothing kernel in pixels. larger means smoother intensity curves.
   :type kernel_N: int, default 30
   :param kernel_sigma: Number of standard deviations to consider for the smoothing kernel.
   :type kernel_sigma: int, default 1

   .. py:attribute:: kernel_N
      :annotation: :int = 30

      

   .. py:attribute:: kernel_sigma
      :annotation: :int = 1

      

   .. py:method:: __post_init__(self)



.. py:class:: LineageGuesserExpansionSpeed

   Bases: :py:obj:`LineageGuesser`

   Guess lineage relations by maximizing the expansion velocity of the bud with respect to the candidate parent.

   :param segmentation:
   :type segmentation: Segmentation
   :param nn_threshold: cell masks separated by less than this threshold are considered neighbors, by default 8.0.
   :type nn_threshold: float, optional
   :param flexible_nn_threshold: If no nearest neighbours are found within the given threshold, try to find the closest one, by default False.
   :type flexible_nn_threshold: bool, optional
   :param num_frames_refractory: After a parent cell has budded, exclude it from the parent pool in the next frames.
                                 It is recommended to set it to a low estimate, as high values will cause mistakes to propagate in time.
                                 A value of 0 corresponds to no refractory period.
                                 by default 0.
   :type num_frames_refractory: int, optional
   :param num_frames: How many frames to consider to compute expansion velocity.
                      At least 2 frames should be considered for good results.
                      by default 5.
   :type num_frames: int, optional
   :param ignore_dist_nan: In some cases the computed expansion distance encounters an error (candidate parent flushed away, invalid contour, etc.),
                           then the computed distance is replaced by nan for the given frame.
                           If this happens for many frames, the computed expansion speed might be nan.
                           Enabling this parameter ignores candidates for which the computed expansion speed is nan, otherwise raises an error.
                           by default True.
   :type ignore_dist_nan: bool, optional
   :param bud_distance_max: Maximal distance (in pixels) between points on the parent and bud contours to be considered as part of the "budding interface".
                            by default 7.
   :type bud_distance_max: float, optional

   .. py:attribute:: num_frames
      :annotation: :int = 5

      

   .. py:attribute:: ignore_dist_nan
      :annotation: :bool = True

      

   .. py:attribute:: bud_distance_max
      :annotation: :float = 7

      

   .. py:method:: __post_init__(self)


   .. py:method:: guess_parent(self, bud_id: int, time_id: int) -> int

      Guess the parent associated to a bud

      :param bud_id: id of the bud in the segmentation
      :type bud_id: int
      :param time_id: frame index in the movie
      :type time_id: int

      :returns: **parent_id** -- guessed parent id
      :rtype: int



.. py:class:: LineageGuesserMinDistance

   Bases: :py:obj:`LineageGuesser`

   Guess lineage relations by finding the cell closest to the bud, when it appears on the segmentation.

   :param segmentation:
   :type segmentation: Segmentation
   :param nn_threshold: cell masks separated by less than this threshold are considered neighbors, by default 8.0.
   :type nn_threshold: float, optional
   :param flexible_nn_threshold: If no nearest neighbours are found within the given threshold, try to find the closest one, by default False.
   :type flexible_nn_threshold: bool, optional
   :param num_frames_refractory: After a parent cell has budded, exclude it from the parent pool in the next frames.
                                 It is recommended to set it to a low estimate, as high values will cause mistakes to propagate in time.
                                 A value of 0 corresponds to no refractory period.
                                 by default 0.
   :type num_frames_refractory: int, optional

   .. py:method:: guess_parent(self, bud_id: int, time_id: int) -> int

      Guess the parent associated to a bud

      :param bud_id: id of the bud in the segmentation
      :type bud_id: int
      :param time_id: frame index in the movie
      :type time_id: int

      :returns: **parent_id** -- guessed parent id
      :rtype: int



.. py:class:: LineageGuesserMinTheta

   Bases: :py:obj:`_MajorityVoteMixin`, :py:obj:`LineageGuesser`

   Guess lineage relations by minimizing the angle between the major axis of the candidates and candidate-to-bud vector.

   :param segmentation:
   :type segmentation: Segmentation
   :param nn_threshold: cell masks separated by less than this threshold are considered neighbors, by default 8.0.
   :type nn_threshold: float, optional
   :param flexible_nn_threshold: If no nearest neighbours are found within the given threshold, try to find the closest one, by default False.
   :type flexible_nn_threshold: bool, optional
   :param num_frames_refractory: After a parent cell has budded, exclude it from the parent pool in the next frames.
                                 It is recommended to set it to a low estimate, as high values will cause mistakes to propagate in time.
                                 A value of 0 corresponds to no refractory period.
                                 by default 0.
   :type num_frames_refractory: int, optional
   :param num_frames: Number of frames to make guesses for after the bud has appeared.
                      The algorithm makes a guess for each frame, then predicts a parent by majority-vote policy.
   :type num_frames: int, default 5
   :param offset_frames: Wait this number of frames after bud appears before guessing parent.
   :type offset_frames: int, default 0


.. py:exception:: LineageException

   Bases: :py:obj:`bread.data.BreadException`

   Base class for warnings generated by user code.


.. py:exception:: LineageWarning

   Bases: :py:obj:`bread.data.BreadWarning`

   Base class for warnings generated by user code.


.. py:exception:: NotEnoughFramesException(bud_id: int, time_id: int, num_requested: int, num_remaining: int)

   Bases: :py:obj:`LineageException`

   Base class for warnings generated by user code.


.. py:exception:: NotEnoughFramesWarning(bud_id: int, time_id: int, num_requested: int, num_remaining: int)

   Bases: :py:obj:`LineageWarning`

   Base class for warnings generated by user code.


